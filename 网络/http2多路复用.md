

http2多路复用？

## HTTP/1.0版本

- 每个TCP连接只能发送一个请求。发送数据完毕后，连接就关闭。如果还要请求其他资源，就必须再新建一个连接。为了解决这个问题，需要使用Connection:keep-alive

- 每次请求都会建立一次HTTP连接，也就是我们常说的3次握手4次挥手，这个过程在一次请求过程中占用了相当长的事件，即使开启了Keep-alive，解决了多次连接的问题，但是依然有两个效率上的问题：
  - 串行的文件传输。当请求a文件时，b文件只能等待，等待a连接到服务器、服务器处理文件、服务器返回文件，这3个步骤。假设这3步用时都是1秒，那么a文件用时3秒，b文件传输完成用时为6秒，一次类推。（前提：浏览器和服务器都是单通道传输）
  - 连接数过多。假设apache设置了最大并发数为300，因为浏览器限制，浏览器发起的最大请求书为6，也就是服务器能承载的最高并发为50，当第51个人访问时，就需要等待前面某个请求处理完成。

## HTTP/1.1版本

- 该版本引入了持久连接（persistent connection），即TCP连接默认不关闭，可以被多个请求复用，不用声明Connection:alive。
- 引入了管道机制（pipelining），即在同一个TCP连接里面，客户端可以同时发送多个请求。这样就进一步改进了HTTP协议的效率。
- 队头堵塞（Head-of-line blocking）：虽然允许复用TCP连接，但是同一个TCP连接里面，所有的数据通信都是按次序进行的。服务器只有处理完一个回应，才会进行下一个回应。要是前面的回应特别慢，后面就会有许多请求排队等着。

## HTTP/2.0版本

- 有2个非常重要的概念，分别是帧（frame）和流（stream）。帧代表最小的数据单位，每个帧会标识出该帧属于哪个流，流也就是多个帧组成的数据流。

- 每一个流都有一个独一无二的标识和优先级，而流就是由二进制组成的。二进制的头部信息会标识自己属于哪一个流，所以这些帧是可以交错传输，然后在接收端通过帧头的信息组装成完整的数据。

- 多路复用，就是在一个TCP连接中可以存在多条流。换句话说，也就是可以发送多个请求，对端可以通过帧中的标识知道属于哪个请求。通过这个技术，可以解决HTTP旧版本中的队头阻塞问题，极大的提高传输性能

- 可以复用TCP连接，在一个连接里，服务器和浏览器都可以同时发送多个请求或回应，而且不用按照顺序一一对应

  比如：在一个TCP连接里面，服务器同时收到了A请求和B请求，于是先回应A请求，结果发现处理过程非常耗时，于是就发送A请求已经处理好的部分，接着回应B请求，完成后，再发送A请求剩下的部分。

- 采用二进制格式传输，取代了HTTP1.x的文本格式，二进制格式解析更高效。
- 多路复用代替了HTTP1.x的序列和阻塞机制，所有的相同域名请求都通过同一个TCP连接并发完成。在HTTP1.x中，并发多个请求需要多个TCP连接，浏览器为了控制资源会有6-8个TCP连接的限制
- 同域名下所有通信都在单个连接上完成，消除了因多个TCP连接而带来的延时和内存消耗
- 单个连接上可以并行交错的请求和响应，之间互不干扰